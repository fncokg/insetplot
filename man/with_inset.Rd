% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/with_inset.R
\name{with_inset}
\alias{with_inset}
\title{Compose a main plot with inset(s)}
\usage{
with_inset(plot, .cfg = last_insetcfg(), .as_is = FALSE)
}
\arguments{
\item{plot}{A ggplot object used as the default for each subplot (unless a
specific spec provides its own \code{plot}).}

\item{.cfg}{An inset configuration (class "insetcfg"). Defaults to
\code{\link[=last_insetcfg]{last_insetcfg()}}.}

\item{.as_is}{Logical. If TRUE, return \code{plot} as-is without creating insets.}
}
\value{
If \code{.return_subplots = FALSE}, a cowplot canvas (inherits from
ggplot) containing the main plot plus inset layers. If TRUE, a list with:
\item{full}{The combined plot}
\item{subplots}{A list of individual subplot ggplot objects}
}
\description{
Build a combined plot using a base ggplot and an inset configuration created
by \code{\link[=config_insetmap]{config_insetmap()}}. For each plot specification in the configuration, the
function either uses the provided \code{spec$plot} or the supplied \code{plot} and adds
spatial coordinates via \code{\link[ggplot2:ggsf]{ggplot2::coord_sf()}} with the given bounding box.
Non-main subplots receive a border from \code{\link[=map_border]{map_border()}}.
}
\details{
The argument \code{.as_is = TRUE} returns the input \code{plot} unchanged and does not
require any configuration. This is convenient for reusing the same plotting
code outside the inset workflow or for testing.
\itemize{
\item Bounding boxes come from each \code{plot_spec()} in \code{.cfg$specs}. Missing bbox
values are filled using the overall extent if available in the configuration.
\item Coordinate systems are applied with \verb{coord_sf(default_crs = .cfg$from_crs, crs = .cfg$to_crs, xlim/ylim = bbox, expand = FALSE)}.
\item Inset sizes: when a spec has \code{no_scale = TRUE}, the inset width/height are
derived from the spatial ranges relative to the main plot; otherwise the
requested \code{width}/\code{height} are used.
\item Best results are achieved when the saved image width-to-height ratio equals
\code{.cfg$full_ratio}.
}
}
\examples{
library(sf)
library(ggplot2)

nc <- sf::st_read(system.file("shape/nc.shp", package = "sf"), quiet = TRUE)

config_insetmap(
    specs = list(
        plot_spec(main = TRUE),
        plot_spec(
            xmin = -84, xmax = -75, ymin = 33, ymax = 37,
            loc = "left bottom", width = 0.3
        )
    ),
    full_ratio = 16 / 9
)

base <- ggplot(nc, aes(fill = AREA)) +
    geom_sf() +
    theme_void()
with_inset(base)

}
\seealso{
\code{\link[=config_insetmap]{config_insetmap()}}, \code{\link[=plot_spec]{plot_spec()}}, \code{\link[=last_insetcfg]{last_insetcfg()}}
}
